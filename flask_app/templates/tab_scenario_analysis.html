<h2>Scenario Analysis</h2>
<div>
    <div style="margin: 30px;">
        <!-- https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file -->
        <form id="scenario-form" method="post" enctype="multipart/form-data" 
            target="_self"
            action="{{ url_for('analyse_scenario_files') }}">
            <div>
              <label for="file">Choose file to upload</label>
              <input type="file" accept=".csv" id="file" name="file" multiple />
            </div>
            <div>
              <button>Submit</button>
            </div>
        </form>          
    </div>

    <div class="tabs"> <!-- https://jqueryui.com/tabs/ -->
        <ul>
          <li><a href="#tab_scenario_events">Events</a></li>
          <li><a href="#tab_scenario_interevents">Inter Events</a></li>
        </ul>
        <div id="tab_scenario_events">
            <h2>Events Data</h2>
            <div id="scenario_table_output_01">Events Table should appear here</div>
        </div>
        <div id="tab_scenario_interevents">
            <h2>Inter Events Data</h2>
            <div id="scenario_table_output_02">Inter Events Table should appear here</div>
        </div>
    </div>

</div>

<!-- Form submission logic -->

<!-- https://stackoverflow.com/questions/5392344/sending-multipart-formdata-with-jquery-ajax -->

<script>
    $(document).ready(function () {

        $("#scenario-form").submit(function (event) {
            
            // Need to prevent default action, 
            // allowing post response to be captured and 
            // rendered on main page, instead of either
            // a. rendering the result at "/analyse_scenario"
            // b. throwing a 405 on post submission to "/"
            // https://stackoverflow.com/a/42517904
            event.preventDefault();


            var fileFormData = new FormData();
            jQuery.each(jQuery('#file')[0].files, function(i, file) {
                fileFormData.append('file-'+i, file);
            });

            jQuery.ajax({
                url: '/analyse_scenario',
                data: fileFormData,
                cache: false,
                contentType: false,
                processData: false,
                method: 'POST',
                type: 'POST', // For jQuery < 1.9
                success: function(data){
                    console.log("response to /analyse_scenario");
                    console.log(data);
                    $( "#scenario_table_output_01" ).html(data["table_events"]);
                    $( "#scenario_table_output_02" ).html(data["table_interevents"]);
                },
                error: function(e) {
                    console.log(e.status);
                    console.log(e.responseText);
                }
            });

        });

    });
    
</script>